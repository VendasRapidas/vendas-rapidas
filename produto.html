<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <title>Produto</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        .galeria-detalhes img {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            max-height: 150px;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-right: 10px;
        }

        .galeria-detalhes img:hover {
            transform: scale(1.1);
            border-color: #007BFF;
        }
    </style>
</head>
<body>
    <header>
        <h1>Detalhes do Produto</h1>
        <nav>
            <a href="index.html">Home</a> |
            <a href="produtos.html">Produtos</a> |
            <a href="sobre.html">Sobre Nós</a>
        </nav>
    </header>

    <main>
        <div id="produto-detalhes"></div>
    </main>

    <script>
        const produtos = {
            1: {
                nome: "Garrafa de Plástico",
                preco: 5.00,
                imagens: [
                    "imagens/GarrafaPlastico1.avif",
                    "imagens/GarrafaPlastico2.avif",
                    "imagens/GarrafaPlastico3.avif"
                ],
                descricao:
                    "Garrafa de Plástico Portátil de 2L, contém canudo, é reutilizável, pode ir à máquina de lavar. Disponível nas cores: Preto, Rosa, Roxo, Azul e Verde"
            },
            2: {
                nome: "Produto 2",
                preco: 20.00,
                imagens: ["imagens/produto2.jpg"],
                descricao: "Descrição detalhada do Produto 2"
            }
        };

        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get("id");
        const produto = produtos[id];

        if (produto) {
            let imagensHTML = produto.imagens
                .map(
                    (img) =>
                        `<img src="${img}" alt="${produto.nome}" />`
                )
                .join("");

            document.getElementById("produto-detalhes").innerHTML = `
                <div class="galeria-detalhes">${imagensHTML}</div>
                <h2>${produto.nome}</h2>
                <p>${produto.descricao}</p>
                <p><strong>Preço:</strong> €${produto.preco.toFixed(2)}</p>
                <button id="btn-comprar">Comprar com Stripe</button>
            `;

            document
                .getElementById("btn-comprar")
                .addEventListener("click", () => {
                    // Converter preço para centavos antes de enviar
                    const precoCentavos = Math.round(produto.preco * 100);

                    fetch("/.netlify/functions/create-checkout-session", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ 
                            name: produto.nome,
                            price: precoCentavos
                        })
                    })
                        .then((res) => res.json())
                        .then((data) => {
                            if(data.url){
                                window.location.href = data.url;
                            } else {
                                alert("Erro ao criar sessão de pagamento.");
                            }
                        })
                        .catch((err) => {
                            alert("Erro ao criar sessão de pagamento.");
                            console.error(err);
                        });
                });
        } else {
            document.getElementById("produto-detalhes").innerHTML =
                "<p>Produto não encontrado.</p>";
        }
    </script>
</body>
</html>
